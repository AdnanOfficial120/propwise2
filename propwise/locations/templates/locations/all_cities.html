{% extends 'base.html' %}
{% load static %}

{% block content %}

<style>
    /* --- PAGE HEADER --- */
    .cities-header {
        text-align: center;
        padding: 60px 20px 40px;
        background: linear-gradient(to bottom, #f8fafc 0%, #ffffff 100%);
    }
    .cities-title {
        font-family: 'Playfair Display', serif;
        font-size: 3rem;
        color: var(--pw-navy);
        font-weight: 700;
        margin-bottom: 15px;
    }
    .cities-sub {
        color: #64748b;
        font-size: 1.1rem;
        max-width: 600px;
        margin: 0 auto;
    }

    /* --- CITY GRID --- */
    .city-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 30px;
        max-width: 1200px;
        margin: 0 auto 80px;
        padding: 0 20px;
    }

    /* --- CITY CARD --- */
    .city-card {
        position: relative;
        height: 350px;
        border-radius: 20px;
        overflow: hidden;
        cursor: pointer;
        text-decoration: none;
        box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), box-shadow 0.4s ease;
    }
    
    .city-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 25px 50px rgba(0,0,0,0.25);
    }

    /* Background Image */
    .city-bg {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        background-size: cover;
        background-position: center;
        transition: transform 0.8s ease;
    }
    
    .city-card:hover .city-bg {
        transform: scale(1.1);
    }

    /* Gradient Overlay */
    .city-overlay {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        background: linear-gradient(to top, 
            rgba(15, 23, 42, 0.95) 0%, 
            rgba(15, 23, 42, 0.5) 50%, 
            rgba(15, 23, 42, 0.1) 100%);
        z-index: 1;
    }

    /* Text Content */
    .city-content {
        position: absolute;
        bottom: 30px;
        left: 30px;
        z-index: 2;
        width: calc(100% - 60px);
    }

    .city-name {
        font-family: 'Playfair Display', serif;
        font-size: 2rem;
        color: white;
        font-weight: 700;
        margin-bottom: 10px;
        text-shadow: 0 4px 10px rgba(0,0,0,0.3);
        line-height: 1;
    }

    .city-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(5px);
        color: var(--pw-gold);
        padding: 6px 14px;
        border-radius: 50px;
        font-size: 0.85rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border: 1px solid rgba(212, 175, 55, 0.3);
        transition: 0.3s;
    }
    
    .city-card:hover .city-badge {
        background: var(--pw-gold);
        color: var(--pw-navy);
    }

    /* Empty State */
    .empty-state {
        grid-column: 1 / -1;
        text-align: center;
        padding: 80px;
        color: #94a3b8;
        background: #f8fafc;
        border-radius: 20px;
        border: 2px dashed #e2e8f0;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .cities-title { font-size: 2.2rem; }
        .city-card { height: 280px; }
        .city-name { font-size: 1.8rem; }
    }
</style>

<div class="cities-header">
    <h1 class="cities-title">Explore Locations</h1>
    <p class="cities-sub">Find your perfect property in the country's most sought-after destinations.</p>
</div>

<div class="city-grid">
    {% for city in cities %}
        <a href="{% url 'city_detail' city_pk=city.pk %}" class="city-card">
            <!-- The JS below will inject a nice random image here -->
            <div class="city-bg" data-index="{{ forloop.counter0 }}"></div>
            
            <div class="city-overlay"></div>
            
            <div class="city-content">
                <div class="city-name">{{ city.name }}</div>
                <div class="city-badge">
                    <i class="fa-solid fa-building"></i>
                    <!-- Django Tip: If you don't have property_set available immediately, 
                         you can just say 'View Listings' -->
                    {% if city.property_set %}
                        {{ city.property_set.count }} Listings
                    {% else %}
                        View Listings
                    {% endif %}
                </div>
            </div>
        </a>
    {% empty %}
        <div class="empty-state">
            <i class="fa-solid fa-map-location-dot" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
            <h3>No Locations Found</h3>
            <p>We are currently expanding to new cities. Check back soon!</p>
        </div>
    {% endfor %}
</div>

<!-- AUTO-IMAGE SCRIPT -->
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // High-quality architectural images from Unsplash
        const cityImages = [
            'https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?q=80&w=800&auto=format&fit=crop', // Chicago style
            'https://images.unsplash.com/photo-1449824913935-59a10b8d2000?q=80&w=800&auto=format&fit=crop', // Urban
            'https://images.unsplash.com/photo-1519501025264-65ba15a82390?q=80&w=800&auto=format&fit=crop', // City sunset
            'https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?q=80&w=800&auto=format&fit=crop', // New York style
            'https://images.unsplash.com/photo-1514565131-fce0801e5785?q=80&w=800&auto=format&fit=crop', // Highrise
            'https://images.unsplash.com/photo-1444723121867-c61e74e36547?q=80&w=800&auto=format&fit=crop'  // City lines
        ];

        const bgDivs = document.querySelectorAll('.city-bg');
        
        bgDivs.forEach((div, index) => {
            // Cycle through the images so every card gets one
            const imgUrl = cityImages[index % cityImages.length];
            div.style.backgroundImage = `url('${imgUrl}')`;
        });
    });
</script>

{% endblock content %}