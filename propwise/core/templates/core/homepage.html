{% extends 'base.html' %}

{% block content %}

{% comment %} --- 1. NEW STYLES FOR BADGES AND SLIDER --- {% endcomment %}
<style>
    /* This is the badge for your new "Featured" (Paid) listings */
    .featured-badge {
        display: inline-block;
        padding: 4px 8px;
        background-color: #fff3cd; /* Light yellow */
        color: #856404; /* Dark yellow/brown */
        font-size: 0.85em;
        font-weight: bold;
        border-radius: 4px;
        margin-left: 8px;
        vertical-align: middle;
    }
    
    /* This is the badge for your "Verified" (Admin-Approved) listings */
    .verified-badge {
        display: inline-block;
        padding: 4px 8px;
        background-color: #d4edda; /* Light green */
        color: #155724; /* Dark green */
        font-size: 0.85em;
        font-weight: bold;
        border-radius: 4px;
        margin-left: 8px;
        vertical-align: middle;
    }

    /* This creates the horizontal scrolling "slider" for featured properties */
    .slider-container {
        display: flex;
        overflow-x: auto; /* This is what makes it scroll horizontally */
        gap: 20px;
        padding: 10px 0 20px 0; /* Add some padding for the scrollbar */
    }
    .slider-card {
        flex: 0 0 300px; /* Each card is 300px wide, and won't shrink */
        border: 1px solid #ccc; 
        padding: 15px; 
        border-radius: 8px; 
    }
    .slider-card img {
        width: 100%;
        height: 180px;
        object-fit: cover;
        border-radius: 4px;
    }
    /* Simple Grid for Categories */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 40px;
        }
        
        .cat-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            text-decoration: none;
            color: #333;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .cat-card:hover {
            transform: translateY(-3px);
            border-color: #0066cc;
            color: #0066cc;
            box-shadow: 0 4px 10px rgba(0,102,204,0.15);
        }
        
        .cat-icon {
            font-size: 2em;
            margin-bottom: 10px;
            color: #0066cc;
        }
        
        .cat-title {
            font-weight: bold;
            font-size: 1.1em;
        }
</style>


<h1>Welcome to PropWise</h1>

{% comment %} --- YOUR SEARCH BOX (No changes, this is perfect) --- {% endcomment %}
<div style="background: #eee; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
    <h3>Find Your Perfect Property</h3>
    <form action="{% url 'property_search' %}" method="get">
        {{ filter_form.form.as_p }}
        <button type="submit" style="background: #0066cc; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin-top: 10px;">
            Search
        </button>
    </form>
</div>

<h3>Browse by Category</h3>
    <div class="category-grid">
        <!-- by category -->
        <!-- 1. HOUSES -->
        <!-- Notice the link: ?property_type=house -->
        <a href="{% url 'property_search' %}?property_type=house" class="cat-card">
            <i class="fa fa-home cat-icon"></i>
            <span class="cat-title">Houses</span>
        </a>

        <!-- 2. PLOTS -->
        <a href="{% url 'property_search' %}?property_type=plot" class="cat-card">
            <i class="fa fa-map-o cat-icon"></i>
            <span class="cat-title">Plots</span>
        </a>

        <!-- 3. APARTMENTS -->
        <a href="{% url 'property_search' %}?property_type=apartment" class="cat-card">
            <i class="fa fa-building cat-icon"></i>
            <span class="cat-title">Apartments</span>
        </a>

        <!-- 4. COMMERCIAL -->
        <a href="{% url 'property_search' %}?property_type=commercial" class="cat-card">
            <i class="fa fa-briefcase cat-icon"></i>
            <span class="cat-title">Commercial</span>
        </a>

    </div>

{% comment %}
{% endcomment %}
{% if featured_properties %}
    <h3 style="border-bottom: 2px solid #0056b3; padding-bottom: 5px;">⭐ Featured Properties</h3>
    
    <div class="slider-container">
        {% for prop in featured_properties %}
            <div class="slider-card">
                
                {% if prop.main_image %}
                    <a href="{% url 'property_detail' pk=prop.pk %}">
                        <img src="{{ prop.main_image.url }}" alt="{{ prop.title }}">
                    </a>
                {% endif %}
                
                <h4>
                    <a href="{% url 'property_detail' pk=prop.pk %}">{{ prop.title }}</a>
                    
                    {% comment %} --- ADD THE FEATURED BADGE --- {% endcomment %}
                    <span class="featured-badge">⭐ Featured</span>
                </h4>

                <p><strong>Price:</strong> PKR {{ prop.price }}</p>
                <p><strong>Location:</strong> {{ prop.area }}</p>
                <p><strong>Type:</strong> {{ prop.get_property_type_display }}</p>
            </div>
        {% endfor %}
    </div>
{% endif %}
{% comment %}
{% endcomment %}


{% comment %} --- 3. UPGRADED "LATEST LISTINGS" SECTION --- {% endcomment %}
<h3>Latest Verified Listings</h3>

<div class="property-list">
    
    {% comment %} --- USE THE 'latest_properties' VARIABLE FROM THE VIEW --- {% endcomment %}
    {% for prop in latest_properties %} 
        <div class="property-card">
            
            {% if prop.main_image %}
                <a href="{% url 'property_detail' pk=prop.pk %}">
                    <img src="{{ prop.main_image.url }}" alt="{{ prop.title }}">
                </a>
            {% endif %}
            
            <h4>
                <a href="{% url 'property_detail' pk=prop.pk %}">
                    {{ prop.title }}
                </a>
                
                {% comment %} --- ADD THE VERIFIED BADGE --- {% endcomment %}
                {% if prop.is_verified %}
                    <span class="verified-badge">✅ Verified</span>
                {% endif %}
            </h4>

            <p><strong>Price:</strong> PKR {{ prop.price }}</p>
            <p><strong>Location:</strong> {{ prop.area }}</p>
            <p><strong>Type:</strong> {{ prop.get_property_type_display }}</p>
            
            <p style="margin-top: 10px;">
                <a href="{% url 'property_detail' pk=prop.pk %}" style="
                    display: inline-block;
                    padding: 8px 16px;
                    background-color: #0066cc;
                    color: white;
                    text-decoration: none;
                    border-radius: 4px;
                    font-size: 14px;
                ">
                    View Details
                </a>
                
                {% comment %} Save/Unsave Button Logic (Copied from your template) {% endcomment %}
                {% if user.is_authenticated %}
                    {% if prop in user.favorites.all %}
                        <form action="{% url 'remove_from_favorites' pk=prop.pk %}" method="POST" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" style="
                                background: #dc3545; color: white; padding: 5px 10px; border: none; 
                                border-radius: 4px; cursor: pointer; font-size: 14px; margin-left: 10px;
                            ">Unsave</button>
                        </form>
                    {% else %}
                        <form action="{% url 'add_to_favorites' pk=prop.pk %}" method="POST" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" style="
                                background: #007bff; color: white; padding: 5px 10px; border: none; 
                                border-radius: 4px; cursor: pointer; font-size: 14px; margin-left: 10px;
                            ">Save</button>
                        </form>
                    {% endif %}
                {% else %}
                    <a href="{% url 'login' %}?next={{ request.path }}" style="
                        background: #007bff; color: white; padding: 5px 10px; border: none; 
                        border-radius: 4px; font-size: 14px; margin-left: 10px; text-decoration: none;
                    ">Save</a>
                {% endif %}
            </p>
        </div>
    {% empty %}
        <p>No properties have been listed yet. Please check back soon!</p>
    {% endfor %}
</div>

{% endblock content %}